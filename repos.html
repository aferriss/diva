<html>
<head>
	<style>
		body{
			padding: 0px;
			margin: 0px;
		}
		#drawCanvas{
			position: absolute;
			top: 0px;
			left: 0px;
			//width:400;
			//height: 300;
		}
	</style>
</head>
<body>
	<div id="container"></div>
		<source src="images/allOne.mp4" type="video/mp4">
	</video>
	<canvas id="drawCanvas" width="400" height="300"></canvas>

	<script id="vertexShader" type="x-shader/x-vertex">
		varying vec2 v_texCoord;
		varying vec2 vUv;

		void main() {

			v_texCoord = uv;
			vUv = v_texCoord;
		
			gl_Position =  projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}
	</script>


	<script id="passThrough" type="x-shader/x-fragment">

	/*
	uniform sampler2D u_image;
	uniform sampler2D pastFrame;
	uniform float alpha;
	
	varying vec2 v_texCoord;


	void main() {
	    vec4 t = texture2D(u_image, v_texCoord);
	    vec4 past = texture2D(pastFrame, v_texCoord);

	    vec3 diff = past.rgb - t.rgb;
	    //diff*= diff;

	    float avg = dot(diff.rgb, vec3(1.0))*255.0;



	    if ( avg < 40.0 ) {
	    	//t.a = 0.0;
	    }

	    gl_FragColor = vec4(vec3(1.0) - t.rgb, 1.0);
	}

	*/


 
 varying vec2 v_texCoord;
 
 uniform vec3 colorToReplace;
 uniform sampler2D u_image;
 uniform sampler2D inputImageTexture2;
 
 void main(){
 	vec3 colorToReplace = vec3(0.7,0.06,0.17);
 	float smoothing = 0.22;
 	float thresholdSensitivity = 0.03;

	vec2 textureCoordinate = v_texCoord;
	vec4 textureColor = texture2D(u_image, textureCoordinate);

	float maskY = 0.2989 * colorToReplace.r + 0.5866 * colorToReplace.g + 0.1145 * colorToReplace.b;
	float maskCr = 0.7132 * (colorToReplace.r - maskY);
	float maskCb = 0.5647 * (colorToReplace.b - maskY);

	float Y = 0.2989 * textureColor.r + 0.5866 * textureColor.g + 0.1145 * textureColor.b;
	float Cr = 0.7132 * (textureColor.r - Y);
	float Cb = 0.5647 * (textureColor.b - Y);

	//     float blendValue = 1.0 - smoothstep(thresholdSensitivity - smoothing, thresholdSensitivity , abs(Cr - maskCr) + abs(Cb - maskCb));
	float blendValue = smoothstep(thresholdSensitivity, thresholdSensitivity + smoothing, distance(vec2(Cr, Cb), vec2(maskCr, maskCb)));

	vec4 fc =  vec4(textureColor.rgb, textureColor.a * blendValue);

	float avg = dot(fc.rgb, vec3(1.0))/3.0;

	if(fc.a < 0.5 ){
		fc.a = 1.0;
		fc.rgb = vec3(textureCoordinate.x, 1.0, textureCoordinate.y);
	}
	gl_FragColor = fc;
 }

	</script>


	<script id="repos" type="x-shader/x-fragment">
			varying vec2 vUv;
			uniform sampler2D tex;
			uniform sampler2D tex2;
			uniform vec2 amt;
			uniform float time;

			vec3 rgb2hsv(vec3 c){
			    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
			    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
			    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
			    
			    float d = q.x - min(q.w, q.y);
			    float e = 1.0e-10;
			    return vec3(abs(( (q.z + (q.w - q.y) / (6.0 * d + e))) ), d / (q.x + e), q.x);
			}

			vec3 hsv2rgb(vec3 c){
			    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
			    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
			    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
			}

			void main() {
				vec4 t1 = texture2D(tex, vUv);

				vec2 diff = vec2(t1.y - t1.x, t1.y - t1.z)*amt;
				vec2 newTexCoords = vUv + diff;

				vec4 t0 = texture2D(tex2, newTexCoords);

				vec3 hsv = rgb2hsv(t0.rgb);

				float range1 = (sin(time*0.0001)/2.0+0.5)*0.01;
				range1 += 0.001;

				float range2 = (sin(0.2+time*0.0001)/2.0+0.5)*0.01;
				range2 += 0.001;

				float range3 = (sin(0.4+time*0.0001)/2.0+0.5)*0.01;
				range3 += 0.001;

				hsv.r += range1;//0.001;
				hsv.r = mod(hsv.r, 1.0);

				hsv.g += range2;
				hsv.g = mod(hsv.g, 1.0);

				hsv.b += range3;
				hsv.b = mod(hsv.b, 1.0);

				vec3 rgb = hsv2rgb(hsv);

				gl_FragColor = vec4(rgb, 1.0);
			}
	</script>







	<script src="scripts/three.js"></script>
	<script src="scripts/OrbitControls.js"></script>
	<script src="scripts/repos.js"></script>
</body>
</html>